package org.spring.LoginDaoImpl;

import java.sql.ResultSet;
import java.sql.SQLException;

import org.spring.DaoLogin.LoginInterfaceMethods;
import org.spring.EmployeeBeans.CustomersBeans;
import org.spring.LoginBeans.LoginsBeans;
import org.spring.UtilityClass.QueryOfDatabase;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.dao.DataAccessException;
import org.springframework.jdbc.core.BeanPropertyRowMapper;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.ResultSetExtractor;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;

@Repository
public class LoginRepositry implements LoginInterfaceMethods {

	@Autowired(required = true)
	JdbcTemplate jdbcTemplate;
	
	public void setJdbcTemplate(JdbcTemplate jdbcTemplate) {
		this.jdbcTemplate = jdbcTemplate;
	}
	LoginsBeans loginbeans;
	@Override
	public int loginForAdmin(LoginsBeans loginbeans) {
		System.out.println("In Repos Class Admin");
		
		
		return jdbcTemplate.query(QueryOfDatabase.adminLoginQuery,new Object[]{loginbeans.getEmail(),loginbeans.getAutogeneratedPwd()},new ResultSetExtractor<Integer>() {

			@Override
			public Integer extractData(ResultSet rs) throws SQLException, DataAccessException {
				int count = 0;
				
				while(rs.next()){
					System.out.println("In resultSet");
					loginbeans.setEmail(rs.getString(1));
					loginbeans.setAutogeneratedPwd(rs.getString(2));
					count = rs.getInt("userId");
				}
				System.out.println("Here Admin Id is"+count);
				return count;
			}
		});
	}

	@Override
	public int loginForEmployee(LoginsBeans loginbeans) {
		System.out.println("In Repos Class Employee");
		return jdbcTemplate.query(QueryOfDatabase.employeeLoginQuery,new Object[]{loginbeans.getEmail(),loginbeans.getAutogeneratedPwd()},new ResultSetExtractor<Integer>() {

			@Override
			public Integer extractData(ResultSet rs) throws SQLException, DataAccessException {
				int count = 0;
				
				while(rs.next()){
					System.out.println("In resultSet");
					loginbeans.setEmail(rs.getString(1));
					loginbeans.setAutogeneratedPwd(rs.getString(2));
					count = rs.getInt("empId");
				}
				System.out.println("Here employee Id is"+count);
				return count;
			}
		});
	}

	@Override
	public int loginForCustomers(LoginsBeans loginbeans) {
		System.out.println("In Repos Class Customers");
		return jdbcTemplate.query(QueryOfDatabase.customerLoginQuery,new Object[]{loginbeans.getEmail(),loginbeans.getAutogeneratedPwd()},new ResultSetExtractor<Integer>() {

			@Override
			public Integer extractData(ResultSet rs) throws SQLException, DataAccessException {
				int count = 0;
				
				while(rs.next()){ 
					System.out.println("In resultSet");
					loginbeans.setEmail(rs.getString(1));
					loginbeans.setAutogeneratedPwd(rs.getString(2));
					count = rs.getInt("custId");
				}
				System.out.println("Here Customer Id is"+count);
				return count;
			}
		});
	}

	@Override
	public int forgotpwdForAdmin(LoginsBeans loginsBeans) {
		System.out.println("Dao Class In Forgot Password for Admin");
		return jdbcTemplate.query(QueryOfDatabase.forgotPwdAdmin,new Object[]{loginsBeans.getEmail()},new ResultSetExtractor<Integer>() {

			@Override
			public Integer extractData(ResultSet rs) throws SQLException, DataAccessException {
				int recordfound =0;
				while(rs.next())
				{
					loginsBeans.setEmail(rs.getString(1));
					 recordfound= rs.getInt("userId");  
				}
				System.out.println("In Dao Class.............. "+recordfound);
				return recordfound;
			}
		} );
		//return null;
	}

	public LoginsBeans gotpwd(int recordfound){
		
		return jdbcTemplate.queryForObject(QueryOfDatabase.adminPass,new Object[]{recordfound},new BeanPropertyRowMapper<LoginsBeans>(LoginsBeans.class));
	/*return jdbcTemplate.query(QueryOfDatabase.adminPass,new ResultSetExtractor<LoginsBeans>() {

		@Override
		public LoginsBeans extractData(ResultSet rs) throws SQLException, DataAccessException {
			LoginsBeans beans = new LoginsBeans();
			if(rs.next()){
				beans.setUserId(rs.getInt(1));
				beans.setEmail(rs.getString(2));
				beans.setPassword(rs.getString(3));
				return beans;
			}
			return null;
		}
	});*/
	}
	
	@Override
	public String forgotpwdForEmployee(LoginsBeans loginsBeans) {
		System.out.println("Dao Class In Forgot Password for Employee");
		return null;
	}

	@Override
	public String forgotpwdForcustomer(LoginsBeans loginsBeans) {
		System.out.println("Dao Class In Forgot Password for Customer");
		return null;
	}
}
