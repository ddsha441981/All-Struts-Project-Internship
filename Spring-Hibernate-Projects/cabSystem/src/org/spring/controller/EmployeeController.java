package org.spring.controller;

import java.sql.SQLException;
import java.util.List;

import javax.servlet.http.HttpServletRequest;

//import org.spring.dto.AddDepartmentBeans;
import org.spring.dto.AddEmployeeBeans;
//import org.spring.services.AddDepartmentServices;
import org.spring.services.AddEmployeeServices;
import org.spring.utility.AutogeneratedPassword;
import org.spring.utility.MailSending;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class EmployeeController {

	@Autowired
	MailSending mailSending;
	
	@Autowired
	AddEmployeeServices addAdminServices;
	
	
	@RequestMapping(value ="addEmployees")
	public String gotoEmployeeRegisterPage(){
		
		return "addEmployeesRegister";
	}
	
	@RequestMapping(value = "/employeeRegisterByHR")
	public String addNewEmployee(AddEmployeeBeans addEmployeeBeans,HttpServletRequest request)throws SQLException{
		
		System.out.println("In Add Emp Controller");
		
		
		//Auto password Generate
		String password = AutogeneratedPassword.GeneratedPassword();
		addEmployeeBeans.setPassword(password);
		//Manager Id 
		int mId = (int) request.getSession().getAttribute("mId");
		addEmployeeBeans.setmId(mId);
		
		System.out.println("Auto password  "+password + "Deparment Id " +addEmployeeBeans.getmId());
		
		
		int status = addAdminServices.addEmployees(addEmployeeBeans);
		System.out.println("Records Of Emp "+status);
		if(status>0){
			String toEmail = ("EmailId:"+addEmployeeBeans.getEmailId());
			String sub = "Employee Register SuccessFully";
			System.out.println(toEmail);
			String subject=(sub);
			String body=("Welcome "+addEmployeeBeans.getName()+" Your Registeration SuccessFully Done\n\n\n "+"EmailID :- " +addEmployeeBeans.getEmailId()+"\n"+"Auto Generated Password :- " +addEmployeeBeans.getPassword()+" ");
			System.out.println(subject);
			System.out.println(body);
			
			//mailSender.mailsending(emailsending.getEmail(), subject, body);
			mailSending.mailsend(addEmployeeBeans.getEmailId(), subject, body);
			
			return "welcome";
		}
		
		else {
			return "Error";
		}
	}
	
	@RequestMapping(value ="/viewDetailsEmployeesData")
	public String viewDetailsEmployee(AddEmployeeBeans addEmployeeBeans,Model model) throws SQLException{
		
		List<AddEmployeeBeans> empList = addAdminServices.viewsEmployees(addEmployeeBeans);
		model.addAttribute("empList", empList);
		return "viewsEmployeesDetails";
	}
}
